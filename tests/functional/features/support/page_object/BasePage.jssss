'use strict';

var driver,
    Promise = require('selenium-webdriver').promise,
    Until = require('selenium-webdriver').until;

function BasePage(context) {
    this.driver = context.driver;
}

BasePage.prototype.visit = function(url) {
  this.driver.get(url);
};

BasePage.prototype.find = function(locator) {
  return this.driver.findElement(locator);
};

BasePage.prototype.click = function(locator) {
  this.find(locator).click();
};

BasePage.prototype.type = function(locator, inputText) {
  this.find(locator).sendKeys(inputText);
};

BasePage.prototype.enter = function(locator) {
  this.find(locator).sendKeys(13);
};

BasePage.prototype.isDisplayed = function(locator) {
  var defer = Promise.defer();
  this.find(locator).isDisplayed().then(function(isDisplayed) {
    defer.fulfill(isDisplayed);
  }, function(error) {
    if (error.name === 'NoSuchElementError') {
      defer.fulfill(false);
    } else {
      defer.reject(error);
    }
  });
  return defer.promise;
};

BasePage.prototype.waitForIsDisplayed = function(locator, timeout) {
  var defer = Promise.defer();
  this.driver.wait(Until.elementLocated(locator), timeout).then(function() {
    var element = driver.findElement(locator);
    this.driver.wait(Until.elementIsVisible(element), timeout).then(function() {
      defer.fulfill(true);
    }, function(error) {
      if (error.name === 'NoSuchElementError') {
        defer.fulfill(false);
      } else {
        defer.reject(error);
      }
    });
  });
  return defer.promise;
};

module.exports = BasePage;
